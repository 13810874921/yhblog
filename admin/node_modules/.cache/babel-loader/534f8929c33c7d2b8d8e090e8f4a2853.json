{"ast":null,"code":"var _jsxFileName = \"/Users/duoduo/Desktop/yh/yhblog/codeBolg/admin/src/pages/AddArticle.js\";\nimport React, { useState, useEffect } from \"react\";\nimport marked from \"marked\";\nimport \"../style/add-article.css\";\nimport { Input, Row, Col, Select, Button, DatePicker, message } from \"antd\";\nimport axios from \"axios\";\nimport ApiUrl from \"../config/urls\";\nimport moment from 'moment';\nconst {\n  Option\n} = Select;\nconst {\n  TextArea\n} = Input;\n\nfunction AddArticle(props) {\n  const [articleId, setArticleId] = useState(0); // 文章的ID，如果是0说明是新增加，如果不是0，说明是修改\n\n  const [articleTitle, setArticleTitle] = useState(\"\"); //文章标题\n\n  const [articleContent, setArticleContent] = useState(\"\"); //markdown的编辑内容\n\n  const [markdownContent, setMarkdownContent] = useState(\"预览内容\"); //html内容\n\n  const [introducemd, setIntroducemd] = useState(); //简介的markdown内容\n\n  const [introducehtml, setIntroducehtml] = useState(\"等待编辑\"); //简介的html内容\n\n  const [showDate, setShowDate] = useState(); //发布日期\n\n  const [updateDate, setUpdateDate] = useState(); //修改日志的日期\n\n  const [typeInfo, setTypeInfo] = useState([]); // 文章类别信息\n\n  const [selectedType, setSelectType] = useState(1); //选择的文章类别\n\n  useEffect(() => {\n    getTypeInfo(); //获取文章id\n\n    let tempId = props.match.params.id;\n\n    if (tempId) {\n      setArticleId(tempId);\n      getArticleById(tempId);\n    }\n  }, []);\n  const renderer = new marked.Renderer();\n  marked.setOptions({\n    renderer: renderer,\n    gfm: true,\n    pedantic: false,\n    sanitize: false,\n    tables: true,\n    breaks: false,\n    smartLists: true,\n    smartypants: false\n  });\n\n  const changeContent = e => {\n    setArticleContent(e.target.value);\n    let html = marked(e.target.value);\n    setMarkdownContent(html);\n  };\n\n  const changeIntorduce = e => {\n    setIntroducemd(e.target.value);\n    let html = marked(e.target.value);\n    setIntroducehtml(html);\n  };\n\n  const getTypeInfo = () => {\n    axios({\n      method: \"get\",\n      url: ApiUrl.getTypeInfo,\n      withCredentials: true // 跨域检验cookie\n\n    }).then(res => {\n      console.log(res.data);\n\n      if (res.data.code == -1) {\n        localStorage.removeItem(\"openId\");\n        props.history.push(\"/\");\n      } else {\n        setTypeInfo(res.data.data);\n      }\n    });\n  };\n\n  const selectTypeHandle = value => {\n    setTypeInfo(value);\n  };\n\n  const saveArticle = () => {\n    if (!selectedType) {\n      message.error(\"必须选择文章类型\");\n      return;\n    } else if (!articleTitle) {\n      message.error(\"文章标题不能为空\");\n      return;\n    } else if (!articleContent) {\n      message.error(\"文章内容不能为空\");\n      return;\n    } else if (!introducemd) {\n      message.error(\"文章简介不能为空\");\n      return;\n    } else if (!showDate) {\n      message.error(\"发布日期不能为空\");\n      return;\n    }\n\n    console.log(showDate.format());\n    const params = {\n      type_id: selectedType,\n      title: articleTitle,\n      article_content: articleContent,\n      introduce: introducemd,\n      create_time: moment(showDate).valueOf()\n    };\n\n    if (articleId == 0) {\n      //添加\n      Object.assign(params, {\n        show_count: 0\n      });\n      axios({\n        method: \"post\",\n        url: ApiUrl.addArticle,\n        data: params,\n        withCredentials: true\n      }).then(res => {\n        console.log(res);\n        setArticleId(res.data.data);\n\n        if (res.data.msg) {\n          message.success(\"文章发布成功\");\n        } else {\n          message.error(\"文章发布失败\");\n        }\n      });\n    } else {\n      //修改\n      Object.assign(params, {\n        id: articleId\n      });\n      axios({\n        method: \"post\",\n        url: ApiUrl.updateArticle,\n        data: params,\n        withCredentials: true\n      }).then(res => {\n        if (res.data.msg) {\n          message.success(\"文章修改成功\");\n        } else {\n          message.error(\"文章修改失败\");\n        }\n      });\n    }\n  };\n\n  const getArticleById = id => {\n    axios(ApiUrl.getArticleById + id, {\n      withCredentials: true\n    }).then(res => {\n      console.log(res.data);\n      const result = res.data.result[0];\n      setArticleTitle(result.title);\n      setArticleContent(result.articleContent);\n      const html = marked(result.articleContent);\n      setMarkdownContent(html);\n      setIntroducemd(result.introduce);\n      const tempInt = marked(result.introduce);\n      setIntroducehtml(tempInt);\n      setShowDate(moment(result.time));\n      setSelectType(result.typeId);\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Row, {\n    gutter: 10,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    span: 18,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Row, {\n    gutter: 20,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    span: 20,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Input, {\n    value: articleTitle,\n    placeholder: \"\\u535A\\u5BA2\\u6807\\u9898\",\n    size: \"large\",\n    onChange: e => setArticleTitle(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(Col, {\n    span: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Select, {\n    defaultValue: selectedType,\n    size: \"large\",\n    onChange: selectTypeHandle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 15\n    }\n  }, typeInfo.map((item, index) => {\n    return /*#__PURE__*/React.createElement(Option, {\n      key: index,\n      value: item.id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 21\n      }\n    }, item.type_name);\n  })))), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(Row, {\n    gutter: 10,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    span: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(TextArea, {\n    className: \"markdown-content\",\n    rows: 35,\n    placeholder: \"\\u6587\\u7AE0\\u5185\\u5BB9\",\n    value: articleContent,\n    onChange: changeContent,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(Col, {\n    span: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"show-html\",\n    dangerouslySetInnerHTML: {\n      __html: markdownContent\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 15\n    }\n  })))), /*#__PURE__*/React.createElement(Col, {\n    span: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Row, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    span: 24,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    size: \"large\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 15\n    }\n  }, \"\\u6682\\u5B58\\u6587\\u7AE0\"), \"\\u2003\", /*#__PURE__*/React.createElement(Button, {\n    type: \"primary\",\n    size: \"large\",\n    onClick: saveArticle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 15\n    }\n  }, \"\\u53D1\\u5E03\\u6587\\u7AE0\")), /*#__PURE__*/React.createElement(Col, {\n    span: 24,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(TextArea, {\n    row: 4,\n    placeholder: \"\\u6587\\u7AE0\\u7B80\\u4ECB\",\n    value: introducemd,\n    onChange: changeIntorduce,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"introduce-html\",\n    dangerouslySetInnerHTML: {\n      __html: introducehtml\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(Col, {\n    span: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"data-select\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(DatePicker, {\n    placeholder: \"\\u53D1\\u5E03\\u65E5\\u671F\",\n    size: \"large\",\n    value: showDate,\n    onChange: (date, dateString) => setShowDate(dateString),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 17\n    }\n  })))))));\n}\n\nexport default AddArticle;","map":{"version":3,"sources":["/Users/duoduo/Desktop/yh/yhblog/codeBolg/admin/src/pages/AddArticle.js"],"names":["React","useState","useEffect","marked","Input","Row","Col","Select","Button","DatePicker","message","axios","ApiUrl","moment","Option","TextArea","AddArticle","props","articleId","setArticleId","articleTitle","setArticleTitle","articleContent","setArticleContent","markdownContent","setMarkdownContent","introducemd","setIntroducemd","introducehtml","setIntroducehtml","showDate","setShowDate","updateDate","setUpdateDate","typeInfo","setTypeInfo","selectedType","setSelectType","getTypeInfo","tempId","match","params","id","getArticleById","renderer","Renderer","setOptions","gfm","pedantic","sanitize","tables","breaks","smartLists","smartypants","changeContent","e","target","value","html","changeIntorduce","method","url","withCredentials","then","res","console","log","data","code","localStorage","removeItem","history","push","selectTypeHandle","saveArticle","error","format","type_id","title","article_content","introduce","create_time","valueOf","Object","assign","show_count","addArticle","msg","success","updateArticle","result","tempInt","time","typeId","map","item","index","type_name","__html","date","dateString"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport marked from \"marked\";\nimport \"../style/add-article.css\";\nimport { Input, Row, Col, Select, Button, DatePicker, message } from \"antd\";\nimport axios from \"axios\";\nimport ApiUrl from \"../config/urls\";\nimport moment from 'moment'\nconst { Option } = Select;\nconst { TextArea } = Input;\nfunction AddArticle(props) {\n  const [articleId, setArticleId] = useState(0); // 文章的ID，如果是0说明是新增加，如果不是0，说明是修改\n  const [articleTitle, setArticleTitle] = useState(\"\"); //文章标题\n  const [articleContent, setArticleContent] = useState(\"\"); //markdown的编辑内容\n  const [markdownContent, setMarkdownContent] = useState(\"预览内容\"); //html内容\n  const [introducemd, setIntroducemd] = useState(); //简介的markdown内容\n  const [introducehtml, setIntroducehtml] = useState(\"等待编辑\"); //简介的html内容\n  const [showDate, setShowDate] = useState(); //发布日期\n  const [updateDate, setUpdateDate] = useState(); //修改日志的日期\n  const [typeInfo, setTypeInfo] = useState([]); // 文章类别信息\n  const [selectedType, setSelectType] = useState(1); //选择的文章类别\n\n  useEffect(() => {\n    getTypeInfo();\n    //获取文章id\n    let tempId = props.match.params.id\n    if(tempId){\n      setArticleId(tempId)\n      getArticleById(tempId)\n    }\n  }, []);\n\n  const renderer = new marked.Renderer();\n  marked.setOptions({\n    renderer: renderer,\n    gfm: true,\n    pedantic: false,\n    sanitize: false,\n    tables: true,\n    breaks: false,\n    smartLists: true,\n    smartypants: false,\n  });\n\n  const changeContent = (e) => {\n    setArticleContent(e.target.value);\n    let html = marked(e.target.value);\n    setMarkdownContent(html);\n  };\n  const changeIntorduce = (e) => {\n    setIntroducemd(e.target.value);\n    let html = marked(e.target.value);\n    setIntroducehtml(html);\n  };\n\n  const getTypeInfo = () => {\n    axios({\n      method: \"get\",\n      url: ApiUrl.getTypeInfo,\n      withCredentials: true, // 跨域检验cookie\n    }).then((res) => {\n      console.log(res.data);\n      if (res.data.code == -1) {\n        localStorage.removeItem(\"openId\");\n        props.history.push(\"/\");\n      } else {\n        setTypeInfo(res.data.data);\n      }\n    });\n  };\n\n  const selectTypeHandle = (value) => {\n    setTypeInfo(value);\n  };\n\n  const saveArticle = () => {\n    if (!selectedType) {\n      message.error(\"必须选择文章类型\");\n      return;\n    } else if (!articleTitle) {\n      message.error(\"文章标题不能为空\");\n      return;\n    } else if (!articleContent) {\n      message.error(\"文章内容不能为空\");\n      return;\n    } else if (!introducemd) {\n      message.error(\"文章简介不能为空\");\n      return;\n    } else if (!showDate) {\n      message.error(\"发布日期不能为空\");\n      return;\n    }\n    console.log(showDate.format())\n    const params = {\n      type_id: selectedType,\n      title: articleTitle,\n      article_content: articleContent,\n      introduce: introducemd,\n      create_time: moment(showDate).valueOf(),\n    };\n    if (articleId == 0) {\n      //添加\n      Object.assign(params, { show_count: 0 });\n      axios({\n        method: \"post\",\n        url: ApiUrl.addArticle,\n        data: params,\n        withCredentials: true,\n      }).then((res) => {\n        console.log(res);\n        setArticleId(res.data.data);\n        if (res.data.msg) {\n          message.success(\"文章发布成功\");\n        } else {\n          message.error(\"文章发布失败\");\n        }\n      });\n    } else {\n      //修改\n      Object.assign(params, { id: articleId });\n      axios({\n        method: \"post\",\n        url: ApiUrl.updateArticle,\n        data: params,\n        withCredentials: true,\n      }).then((res) => {\n        if (res.data.msg) {\n          message.success(\"文章修改成功\");\n        } else {\n          message.error(\"文章修改失败\");\n        }\n      });\n    }\n  };\n  const getArticleById = (id) => {\n    axios(ApiUrl.getArticleById + id, { withCredentials: true }).then(res=>{\n      console.log(res.data)\n      const result = res.data.result[0]\n      setArticleTitle(result.title)\n      setArticleContent(result.articleContent)\n      const html = marked(result.articleContent)\n      setMarkdownContent(html)\n      setIntroducemd(result.introduce)\n      const tempInt = marked(result.introduce)\n      setIntroducehtml(tempInt)\n      setShowDate(moment(result.time))\n      setSelectType(result.typeId)\n    });\n  };\n\n  return (\n    <div>\n      <Row gutter={10}>\n        <Col span={18}>\n          <Row gutter={20}>\n            <Col span={20}>\n              <Input\n                value={articleTitle}\n                placeholder=\"博客标题\"\n                size=\"large\"\n                onChange={(e) => setArticleTitle(e.target.value)}\n              />\n            </Col>\n            <Col span={4}>\n              <Select\n                defaultValue={selectedType}\n                size=\"large\"\n                onChange={selectTypeHandle}\n              >\n                {typeInfo.map((item, index) => {\n                  return (\n                    <Option key={index} value={item.id}>\n                      {item.type_name}\n                    </Option>\n                  );\n                })}\n              </Select>\n            </Col>\n          </Row>\n          <br />\n          <Row gutter={10}>\n            <Col span={12}>\n              <TextArea\n                className=\"markdown-content\"\n                rows={35}\n                placeholder=\"文章内容\"\n                value={articleContent}\n                onChange={changeContent}\n              />\n            </Col>\n            <Col span={12}>\n              <div\n                className=\"show-html\"\n                dangerouslySetInnerHTML={{ __html: markdownContent }}\n              ></div>\n            </Col>\n          </Row>\n        </Col>\n        <Col span={6}>\n          <Row>\n            <Col span={24}>\n              <Button size=\"large\">暂存文章</Button>&emsp;\n              <Button type=\"primary\" size=\"large\" onClick={saveArticle}>\n                发布文章\n              </Button>\n            </Col>\n            <Col span={24}>\n              <br />\n              <TextArea\n                row={4}\n                placeholder=\"文章简介\"\n                value={introducemd}\n                onChange={changeIntorduce}\n              />\n              <div\n                className=\"introduce-html\"\n                dangerouslySetInnerHTML={{ __html: introducehtml }}\n              ></div>\n            </Col>\n            <Col span={12}>\n              <br />\n              <div className=\"data-select\">\n                <DatePicker\n                  placeholder=\"发布日期\"\n                  size=\"large\"\n                  value={showDate}\n                  onChange={(date, dateString) => setShowDate(dateString)}\n                />\n              </div>\n            </Col>\n          </Row>\n        </Col>\n      </Row>\n    </div>\n  );\n}\n\nexport default AddArticle;\n"]},"metadata":{},"sourceType":"module"}