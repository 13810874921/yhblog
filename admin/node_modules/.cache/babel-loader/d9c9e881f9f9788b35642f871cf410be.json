{"ast":null,"code":"var _jsxFileName = \"/Users/duoduo/Desktop/yh/yhblog/codeBolg/admin/src/pages/AddArticle.js\";\nimport React, { useState, useEffect } from \"react\";\nimport marked from \"marked\";\nimport \"../style/add-article.css\";\nimport { Input, Row, Col, Select, Button, DatePicker, message } from \"antd\";\nimport axios from 'axios';\nimport ApiUrl from '../config/urls';\nconst {\n  Option\n} = Select;\nconst {\n  TextArea\n} = Input;\n\nfunction AddArticle(props) {\n  const [articleId, setArticleId] = useState(0); // 文章的ID，如果是0说明是新增加，如果不是0，说明是修改\n\n  const [articleTitle, setArticleTitle] = useState(\"\"); //文章标题\n\n  const [articleContent, setArticleContent] = useState(\"\"); //markdown的编辑内容\n\n  const [markdownContent, setMarkdownContent] = useState(\"预览内容\"); //html内容\n\n  const [introducemd, setIntroducemd] = useState(); //简介的markdown内容\n\n  const [introducehtml, setIntroducehtml] = useState(\"等待编辑\"); //简介的html内容\n\n  const [showDate, setShowDate] = useState(); //发布日期\n\n  const [updateDate, setUpdateDate] = useState(); //修改日志的日期\n\n  const [typeInfo, setTypeInfo] = useState([]); // 文章类别信息\n\n  const [selectedType, setSelectType] = useState(1); //选择的文章类别\n\n  useEffect(() => {\n    getTypeInfo();\n  }, []);\n  const renderer = new marked.Renderer();\n  marked.setOptions({\n    renderer: renderer,\n    gfm: true,\n    pedantic: false,\n    sanitize: false,\n    tables: true,\n    breaks: false,\n    smartLists: true,\n    smartypants: false\n  });\n\n  const changeContent = e => {\n    setArticleContent(e.target.value);\n    let html = marked(e.target.value);\n    setMarkdownContent(html);\n  };\n\n  const changeIntorduce = e => {\n    setIntroducemd(e.target.value);\n    let html = marked(e.target.value);\n    setIntroducehtml(html);\n  };\n\n  const getTypeInfo = () => {\n    axios({\n      method: \"get\",\n      url: ApiUrl.getTypeInfo,\n      withCredentials: true // 跨域检验cookie\n\n    }).then(res => {\n      console.log(res.data);\n\n      if (res.data.code == -1) {\n        localStorage.removeItem('openId');\n        props.history.push('/');\n      } else {\n        setTypeInfo(res.data.data);\n      }\n    });\n  };\n\n  const selectTypeHandle = value => {\n    setTypeInfo(value);\n  };\n\n  const saveArticle = () => {\n    if (!selectedType) {\n      message.error(\"必须选择文章类型\");\n      return;\n    } else if (!articleTitle) {\n      message.error(\"文章标题不能为空\");\n      return;\n    } else if (!articleContent) {\n      message.error(\"文章内容不能为空\");\n      return;\n    } else if (!introducemd) {\n      message.error(\"文章简介不能为空\");\n      return;\n    } else if (!showDate) {\n      message.error(\"发布日期不能为空\");\n      return;\n    }\n\n    message.success(\"检验通过\");\n    const params = {\n      type_id: selectedType,\n      title: articleTitle,\n      article_content: articleContent,\n      introduce: introducemd,\n      create_time: new Date(showDate.replace('-', '/')).getTime()\n    };\n\n    if (articleId == 0) {\n      Object.assign(params, {\n        show_count: 0\n      });\n      axios({\n        method: \"post\",\n        url: ApiUrl.addArticle,\n        data: params,\n        withCredentials: true\n      }).then(res => {\n        setArticleId(res.data.insertId);\n      });\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Row, {\n    gutter: 10,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    span: 18,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Row, {\n    gutter: 20,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    span: 20,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Input, {\n    value: articleTitle,\n    placeholder: \"\\u535A\\u5BA2\\u6807\\u9898\",\n    size: \"large\",\n    onChange: e => setArticleTitle(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(Col, {\n    span: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Select, {\n    defaultValue: selectedType,\n    size: \"large\",\n    onChange: selectTypeHandle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 15\n    }\n  }, typeInfo.map((item, index) => {\n    return /*#__PURE__*/React.createElement(Option, {\n      key: index,\n      value: item.id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 26\n      }\n    }, item.type_name);\n  })))), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(Row, {\n    gutter: 10,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    span: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(TextArea, {\n    className: \"markdown-content\",\n    rows: 35,\n    placeholder: \"\\u6587\\u7AE0\\u5185\\u5BB9\",\n    onChange: changeContent,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(Col, {\n    span: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"show-html\",\n    dangerouslySetInnerHTML: {\n      __html: markdownContent\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 15\n    }\n  })))), /*#__PURE__*/React.createElement(Col, {\n    span: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Row, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    span: 24,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    size: \"large\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 15\n    }\n  }, \"\\u6682\\u5B58\\u6587\\u7AE0\"), \"\\u2003\", /*#__PURE__*/React.createElement(Button, {\n    type: \"primary\",\n    size: \"large\",\n    onClick: saveArticle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 15\n    }\n  }, \"\\u53D1\\u5E03\\u6587\\u7AE0\")), /*#__PURE__*/React.createElement(Col, {\n    span: 24,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(TextArea, {\n    row: 4,\n    placeholder: \"\\u6587\\u7AE0\\u7B80\\u4ECB\",\n    onChange: changeIntorduce,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"introduce-html\",\n    dangerouslySetInnerHTML: {\n      __html: introducehtml\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(Col, {\n    span: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"data-select\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(DatePicker, {\n    placeholder: \"\\u53D1\\u5E03\\u65E5\\u671F\",\n    size: \"large\",\n    onChange: (date, dateString) => setShowDate(dateString),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 17\n    }\n  })))))));\n}\n\nexport default AddArticle;","map":{"version":3,"sources":["/Users/duoduo/Desktop/yh/yhblog/codeBolg/admin/src/pages/AddArticle.js"],"names":["React","useState","useEffect","marked","Input","Row","Col","Select","Button","DatePicker","message","axios","ApiUrl","Option","TextArea","AddArticle","props","articleId","setArticleId","articleTitle","setArticleTitle","articleContent","setArticleContent","markdownContent","setMarkdownContent","introducemd","setIntroducemd","introducehtml","setIntroducehtml","showDate","setShowDate","updateDate","setUpdateDate","typeInfo","setTypeInfo","selectedType","setSelectType","getTypeInfo","renderer","Renderer","setOptions","gfm","pedantic","sanitize","tables","breaks","smartLists","smartypants","changeContent","e","target","value","html","changeIntorduce","method","url","withCredentials","then","res","console","log","data","code","localStorage","removeItem","history","push","selectTypeHandle","saveArticle","error","success","params","type_id","title","article_content","introduce","create_time","Date","replace","getTime","Object","assign","show_count","addArticle","insertId","map","item","index","id","type_name","__html","date","dateString"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport marked from \"marked\";\nimport \"../style/add-article.css\";\nimport { Input, Row, Col, Select, Button, DatePicker, message } from \"antd\";\nimport axios from 'axios'\nimport ApiUrl from '../config/urls'\nconst { Option } = Select;\nconst { TextArea } = Input;\n\n\nfunction AddArticle(props) {\n  const [articleId, setArticleId] = useState(0); // 文章的ID，如果是0说明是新增加，如果不是0，说明是修改\n  const [articleTitle, setArticleTitle] = useState(\"\"); //文章标题\n  const [articleContent, setArticleContent] = useState(\"\"); //markdown的编辑内容\n  const [markdownContent, setMarkdownContent] = useState(\"预览内容\"); //html内容\n  const [introducemd, setIntroducemd] = useState(); //简介的markdown内容\n  const [introducehtml, setIntroducehtml] = useState(\"等待编辑\"); //简介的html内容\n  const [showDate, setShowDate] = useState(); //发布日期\n  const [updateDate, setUpdateDate] = useState(); //修改日志的日期\n  const [typeInfo, setTypeInfo] = useState([]); // 文章类别信息\n  const [selectedType, setSelectType] = useState(1); //选择的文章类别\n\n\n  useEffect(()=>{\n    getTypeInfo()\n  },[])\n\n\n  const renderer = new marked.Renderer()\n    marked.setOptions({\n        renderer:renderer,\n        gfm:true,\n        pedantic:false,\n        sanitize:false,\n        tables:true,\n        breaks:false,\n        smartLists:true,\n        smartypants:false\n    })\n\n  const changeContent = e =>{\n      setArticleContent(e.target.value)\n      let html = marked(e.target.value)\n      setMarkdownContent(html)\n  }\n  const changeIntorduce = e =>{\n      setIntroducemd(e.target.value)\n      let html = marked(e.target.value)\n      setIntroducehtml(html)\n  }\n\n  const getTypeInfo =()=>{\n    axios({\n      method:\"get\",\n      url:ApiUrl.getTypeInfo,\n      withCredentials:true // 跨域检验cookie\n    }).then(res=>{\n      console.log(res.data)\n      if(res.data.code==-1){\n        localStorage.removeItem('openId')\n        props.history.push('/')\n      }else{\n        setTypeInfo(res.data.data)\n      }\n    })\n  }\n\n  const selectTypeHandle=value=>{\n    setTypeInfo(value)\n  }\n\n  const saveArticle=()=>{\n    if(!selectedType){\n      message.error(\"必须选择文章类型\")\n      return\n    }else\n    if(!articleTitle){\n      message.error(\"文章标题不能为空\")\n      return\n    }else\n    if(!articleContent){\n      message.error(\"文章内容不能为空\")\n      return\n    }else\n    if(!introducemd){\n      message.error(\"文章简介不能为空\")\n      return\n    }else\n    if(!showDate){\n      message.error(\"发布日期不能为空\")\n      return\n    }\n    message.success(\"检验通过\")\n    const params = {\n      type_id : selectedType,\n      title:articleTitle,\n      article_content:articleContent,\n      introduce:introducemd,\n      create_time:new Date(showDate.replace('-','/')).getTime(),\n    }\n    if(articleId==0){\n      Object.assign(params,{show_count:0})\n      axios({\n        method:\"post\",\n        url:ApiUrl.addArticle,\n        data:params,\n        withCredentials:true\n      }).then(res=>{\n        setArticleId(res.data.insertId)\n      })\n    }\n  }\n  return (\n    <div>\n      <Row gutter={10}>\n        <Col span={18}>\n          <Row gutter={20}>\n            <Col span={20}>\n              <Input value={articleTitle} placeholder=\"博客标题\" size=\"large\" onChange={e=>setArticleTitle(e.target.value)}/>\n            </Col>\n            <Col span={4}>\n              <Select defaultValue={selectedType} size=\"large\" onChange={selectTypeHandle}>\n                {\n                  typeInfo.map((item,index)=>{\n                  return <Option key={index} value={item.id}>{item.type_name}</Option>\n                  })\n                }\n              </Select>\n            </Col>\n          </Row>\n          <br />\n          <Row gutter={10}>\n            <Col span={12}>\n              <TextArea\n                className=\"markdown-content\"\n                rows={35}\n                placeholder=\"文章内容\"\n                onChange={changeContent}\n              />\n            </Col>\n            <Col span={12}>\n              <div className=\"show-html\"\n              dangerouslySetInnerHTML={{__html:markdownContent}}>\n              </div>\n            </Col>\n          </Row>\n        </Col>\n        <Col span={6}>\n          <Row>\n            <Col span={24}>\n              <Button size=\"large\">暂存文章</Button>&emsp;\n              <Button type=\"primary\" size=\"large\" onClick={saveArticle}>\n                发布文章\n              </Button>\n            </Col>\n            <Col span={24}>\n              <br />\n              <TextArea row={4} placeholder=\"文章简介\" onChange={changeIntorduce} />\n              <div className=\"introduce-html\"\n              dangerouslySetInnerHTML={{__html:introducehtml}}\n              ></div>\n            </Col>\n            <Col span={12}>\n              <br />\n              <div className=\"data-select\">\n                <DatePicker placeholder=\"发布日期\" size=\"large\" onChange={(date,dateString)=>(setShowDate(dateString))}/>\n              </div>\n            </Col>\n          </Row>\n        </Col>\n      </Row>\n    </div>\n  );\n}\n\nexport default AddArticle;\n"]},"metadata":{},"sourceType":"module"}